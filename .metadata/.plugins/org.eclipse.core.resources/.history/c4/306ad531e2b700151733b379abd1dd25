package com.http.ImplementProtocalBySocket;

import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class ProtocolUtil {

	public static Request readRequest(InputStream input) throws IOException {
		// read encode
		byte[] encodeBytes = new byte[1];
		input.read(encodeBytes);
		byte encode = encodeBytes[0];

		// read command length
		byte[] commandLengthBytes = new byte[4];
		input.read(commandLengthBytes);
		int commandLength = ByteUtil.bytes2Int(commandLengthBytes);
		
		// read command
		byte[] commandBytes = new byte[4];
		input.read(commandBytes);
		String command = "";
		if(Encode.GBK.getValue() == encode){
			command = new String(commandBytes,"GBK");
		}else{
			command = new String(commandBytes,"UTF8");
		}
		
		// create a Request object
		Request request = new Request();
		request.setCommand(command);
		request.setEncode(encode);
		request.setCommandLength(commandLength);
		
		return request;
	}
	

	public static Response readResponse(InputStream input) {
			
		byte[] encodeByte = new byte[1];
			input.read(encodeByte);
			byte encode = encodeByte[0];
			
			//读取响应长度
			byte[] responseLengthByte = new byte[4];
			input.read(responseLengthByte);
			int responseLength = ByteUtil.bytes2Int(responseLengthByte);
			
			//读取响应内容
			byte[] responseBytes = new byte[responseLength];
			input.read(responseBytes);
			String responseStr = "";
			
			//设置编码
			if(Encode.GBK.getValue() == encode){
				responseStr = new String(responseBytes,"GBK");
			}else{
				responseStr = new String(responseBytes,"UTF8");
			}
					
			//组装响应
			Response response = new Response();
			response.setEncode(encode);
			response.setResponse(responseStr);
			response.setResponseLength(responseLength);
			
			return response;
	}

	public static void writeResponse(OutputStream output, Response response) {
		
	}

	public static void writeRequest(OutputStream output, Request request) {
		
	}
}
